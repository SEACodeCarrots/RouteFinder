<!-- RouteBoxer code sample from http://google-maps-utility-library-v3.googlecode.com/svn/trunk/routeboxer/docs/examples.html -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Route Finder</title>
    <link href="style.css" rel="stylesheet" type="text/css">
    <script src="https://maps.google.com/maps/api/js?v=3.exp&signed_in=true&libraries=places" type="text/javascript"></script>
    <script src="https://google-maps-utility-library-v3.googlecode.com/svn/trunk/routeboxer/src/RouteBoxer.js" type="text/javascript"></script>
    <script type="text/javascript">
    var map = null;
    var boxpolys = null;
    var directions = null;
    var routeBoxer = null;
    var distance = null; // km
    var placesService = new google.maps.places.PlacesService();
    var placeDetail = null;
    var apiDelay = 1000;
    var infowindow = new google.maps.InfoWindow();  
    var markers = [];
        
    function initialize() {
      // Default the map view to the continental U.S.
        
      var mapOptions = {
        center: new google.maps.LatLng(37.09024, -95.712891),
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        zoom: 4
      };
        
      map = new google.maps.Map(document.getElementById("map"), mapOptions);
      routeBoxer = new RouteBoxer(); // Class that returns a list of LatLngBounds (boxes) along a route.
        
      directionService = new google.maps.DirectionsService(); // Class for getting directions from one place to another.
        
      directionsRenderer = new google.maps.DirectionsRenderer({ map: map }); // Class that renders the directions on screen.
        
      placesService = new google.maps.places.PlacesService(map); // Class for searching for places of interest within a LatLngBounds scope.
        
      infowindow = new google.maps.InfoWindow(); // The window that pops up when you click on a place marker. Gives details about the place.
    }
    
    function route() {
      // Clear any previous route boxes from the map
      clearBoxes();
      clearMarkers();
      
      // Convert the distance to box around the route from miles to km
      distance = parseFloat(document.getElementById("distance").value) * 1.609344;
      
        
      var request = {
        origin: document.getElementById("from").value,
        destination: document.getElementById("to").value,
        
        
        travelMode: google.maps.DirectionsTravelMode.DRIVING
      }
      
      // Make the directions request
      directionService.route(request, function(result, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          directionsRenderer.setDirections(result);
            
          // Box around the overview path of the first route
          var path = result.routes[0].overview_path;
          var boxes = routeBoxer.box(path, distance);
          drawBoxes(boxes);
         
        } else {
          alert("Directions query failed: " + status);
        }
      });
    }
    
    // Invisible drawing of the array of boxes on the map
    function drawBoxes(boxes) {
      boxpolys = new Array(boxes.length);
        
      var placeTypes = [];
      placeTypes.push (document.getElementById("placeTypes").value)
        
      for (var i = 0; i < boxes.length; i++) {
        boxpolys[i] = new google.maps.Rectangle({
          bounds: boxes[i],
          fillOpacity: 0,
          strokeOpacity: 0,
          strokeColor: '#000000',
          strokeWeight: 0,
          map: map
        });

        var request = {
        bounds: boxes[i],
        types: placeTypes
        };
          
        placesService = new google.maps.places.PlacesService(map);
        google.maps.event.addListenerOnce(map, 'bounds_changed', findPlaces(request));
    }
        
}
    function findPlaces(request) {
        placesService.radarSearch(request, callback);
    }
        
    function callback(results, status) {
        
        if (status == google.maps.places.PlacesServiceStatus.OK) {
            for (var i = 0; i < results.length; i++) {
            var place = results[i];
            createMarker(results[i]);
            }
        }
         else if (status == google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT) {
            alert("Your route is too large or broad. Please reduce your route's distance or increase your route's mile radius.");
            //setTimeout(callback(results), status);
            return; 
        }
    }           
        
    function createMarker(place) {
        var marker = new google.maps.Marker({
        map: map,
        position: place.geometry.location,
        });
        
        markers.push(marker);
        google.maps.event.addListener(marker, 'click', function () {
            
        placesService.getDetails(place, function(details, status) {
                
                if (status == google.maps.places.PlacesServiceStatus.OK) {
                // Add an event listener for the "click" event so that when user clicks on this marker,
                // we will show details about this place.
                    var contentString = '';
                        if (details.name != null) {
                        contentString += details.name + "<br />";
                        }
                
                        if (details.formatted_address != null) {
                        contentString += details.formatted_address +"<br />";
                        }
                    
                        if (details.website != null) {
                        contentString += details.website + "<br />";
                        }
                    
                        if (details.rating != null) {
                        contentString += details.rating + "<br />";
                        }
                
                        if (details.formatted_phone_number != null) {
                        contentString += details.formatted_phone_number;
                        }
                    
                    infowindow.setContent(contentString);
                    infowindow.open(map, marker);
                    }   
        });
    });
}
//        // If this place type has an icon (e.g., a shopping bag icon to represent type=store),
//        // use the icon as the marker. Otherwise, we'll use default marker.
//        var image = null;
//        if (place.icon) {
//            var image = new google.maps.MarkerImage(
//                      place.icon, new google.maps.Size(25, 25),
//                      new google.maps.Point(0, 0), new google.maps.Point(10, 20),
//                      new google.maps.Size(25, 25));
//        }
        
    // Clear boxes currently on the map
    function clearBoxes() {
      if (boxpolys != null) {
        for (var i = 0; i < boxpolys.length; i++) {
          boxpolys[i].setMap(null);
        }
      }
      boxpolys = null;
    }   
        
    function setAllMap(map){
      for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(map);
          
        }
    }
    function clearMarkers(){
        setAllMap(null);
        markers = [];
        placeTypes = [];        
    }
        
  </script>
  <style>
    #map {
      border: 1px solid black;
    }
  </style>
  </head>

  <body onload="initialize();">
    <div id="map" style="width: 400px; height: 300px;"></div>
    Looking for  <select id = "placeTypes"> 
    <option value="amusement_park">Amusement Park</option>
    <option value="aquarium">Aquarium</option>
    <option value="art_gallery">Art Gallery</option>
</select>
    <br>
    within at least <br><input type="text" id="distance" value="5" size="2">miles
      <br>
    from <br><input type="text" id="from" value=""/>
      <br>
    to <br><input type="text" id="to" value=""/>
      <br>
    <input type="submit" onclick="route()"/>
  </body>
</html>